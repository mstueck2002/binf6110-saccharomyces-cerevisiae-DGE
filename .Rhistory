#Clean protein_id column
blast_map$protein_id <- str_extract(
blast_map$protein_id,
"PTN\\d+\\.\\d+"
)
#Filter for noise
blast_map <- blast_map %>%
filter(identity > 30) %>%
filter(bitscore > 50)
#Import reference genome protein annotations
gff <- import("GCA_003046745.1_ASM304674v1_genomic.gff.gz")
gff_df <- as.data.frame(gff) %>%
subset(gbkey == "CDS") %>%
dplyr::select(locus_tag, protein_id)
#Merge reference genome protein annotations and blast orthologs
gene_map <- merge(
gff_df,
blast_map,
by = "protein_id"
)
#Clean ORF column
gene_map$ORF <- str_extract(
gene_map$ORF,
"(?<=\\|)[A-Z0-9]+(?=_YEAST)"
)
gene_map <- gene_map[c("protein_id","locus_tag","ORF")]
colnames(gene_map) <- c("protein_id","locus_tag","GENENAME")
#Map gene name ORF to yeast ORF
orf_map <- select(
org.Sc.sgd.db,
keys = gene_map$GENENAME,
keytype = "GENENAME",
columns = "ORF"
)
#Remove empty rows
orf_map_clean <- orf_map %>%
filter(!is.na(ORF))
#Merge dataframes
gene_orf <- merge(gene_map, orf_map_clean, by = "GENENAME", all.x=FALSE)
#Remove duplicate locus IDs
gene_orf_clean <- gene_orf %>%
distinct(locus_tag, .keep_all = TRUE)
#Build clusters data frame
clusters_df <- clusters$df
colnames(clusters_df) <- c("locus_tag", "cluster")
cluster_orfs <- merge(
gene_orf_clean,
clusters_df,
by = "locus_tag"
)
#Keep clean columns
cluster_orfs <- cluster_orfs %>%
dplyr::select(ORF, cluster)
#Remove any duplicates
cluster_orfs <- cluster_orfs %>%
distinct(ORF, cluster)
#Define Gene Universe
gene_universe <- unique(cluster_orfs$ORF)
#GO enrichment by cluster
go_compare <- compareCluster(
ORF ~ cluster,
data = cluster_orfs,
fun = "enrichGO",
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe,
ont = "BP",
)
#KEGG enrichment by cluster
kegg_compare <- compareCluster(
ORF ~ cluster,
data = cluster_orfs,
fun = "enrichKEGG",
organism = "sce",
universe = gene_universe
)
#Plot
dotplot(go_compare, showCategory = 10) +
ggtitle("GO-BP Enrichment by Cluster")
dotplot(kegg_compare, showCategory = 10) +
ggtitle("KEGG Pathway Enrichment by Cluster")
#Get common yeast ORF names for Early vs Thin genes
orf_thin_vs_early <- res_thin_vs_early_df
colnames(orf_thin_vs_early) <- c("baseMean","log2FoldChange","lfcSE","pvalue","padj","locus_tag","significant")
orf_thin_vs_early <- merge(gene_orf_clean, orf_thin_vs_early, by = "locus_tag")
#Pull significant genes
sig_genes_thin <- orf_thin_vs_early %>%
filter(padj < 0.05 & abs(log2FoldChange) > 1) %>%
pull(ORF)
#Separate up and down regulated genes
up_genes_thin <- orf_thin_vs_early %>%
filter(significant == "Up") %>%
pull(ORF)
down_genes_thin <- orf_thin_vs_early %>%
filter(significant == "Down") %>%
pull(ORF)
#Define new gene universe
gene_universe_thin <- unique(orf_thin_vs_early$ORF)
#GO enrichment
ego_thin_vs_early <- enrichGO(
gene = sig_genes_thin,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_thin,
ont = "BP"
)
#Upregulated Biology
ego_up <- enrichGO(
gene = up_genes_thin,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_thin,
ont = "BP"
)
#Downregulated Biology
ego_down <- enrichGO(
gene = down_genes_thin,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_thin,
ont = "BP"
)
#KEGG Enrichment
kk_thin_vs_early <- enrichKEGG(
gene = sig_genes_thin,
organism = "sce",
universe = gene_universe_thin
)
#Plot
dotplot(ego_thin_vs_early, showCategory = 10) +
ggtitle("GO-BP Early vs Thin Enrichment")
dotplot(ego_up, showCategory = 10) +
ggtitle("GO-BP Early vs Thin Up-Regulated Gene Enrichment")
dotplot(ego_down, showCategory = 10) +
ggtitle("GO-BP Early vs Thin Down-Regulated Gene Enrichment")
dotplot(kk_thin_vs_early, showCategory = 10) +
ggtitle("KEGG Early vs Thin Pathway Enrichment")
#Get common yeast ORF names for Mature vs early genes
orf_mature_vs_early <- res_mature_vs_early_df
colnames(orf_mature_vs_early) <- c("baseMean","log2FoldChange","lfcSE","pvalue","padj","locus_tag","significant")
orf_mature_vs_early <- merge(gene_orf_clean, orf_mature_vs_early, by = "locus_tag")
#Pull significant genes
sig_genes_mature <- orf_mature_vs_early %>%
filter(padj < 0.05 & abs(log2FoldChange) > 1) %>%
pull(ORF)
#Separate up and down regulated genes
up_genes_mature <- orf_mature_vs_early %>%
filter(significant == "Up") %>%
pull(ORF)
down_genes_mature <- orf_mature_vs_early %>%
filter(significant == "Down") %>%
pull(ORF)
#Define new gene universe
gene_universe_mature <- unique(orf_mature_vs_early$ORF)
#GO enrichment
ego_mature_vs_early <- enrichGO(
gene = sig_genes_mature,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_mature,
ont = "BP"
)
#Upregulated Biology
ego_up2 <- enrichGO(
gene = up_genes_mature,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_mature,
ont = "BP"
)
#Downregulated Biology
ego_down2 <- enrichGO(
gene = down_genes_mature,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_mature,
ont = "BP"
)
#KEGG Enrichment
kk_mature_vs_early <- enrichKEGG(
gene = sig_genes_mature,
organism = "sce",
universe = gene_universe_mature
)
#Plot
dotplot(ego_mature_vs_early, showCategory = 10) +
ggtitle("GO-BP Early vs Mature Enrichment")
dotplot(ego_up2, showCategory = 10) +
ggtitle("GO-BP Early vs Mature Up-Regulated Gene Enrichment")
dotplot(ego_down2, showCategory = 10) +
ggtitle("GO-BP Early vs Mature Down-Regulated Gene Enrichment")
dotplot(kk_mature_vs_early, showCategory = 10) +
ggtitle("KEGG Early vs Mature Pathway Enrichment")
#Get common yeast ORF names for Mature vs Thin genes
orf_mature_vs_thin <- res_mature_vs_thin_df
colnames(orf_mature_vs_thin) <- c("baseMean","log2FoldChange","lfcSE","pvalue","padj","locus_tag","significant")
orf_mature_vs_thin <- merge(gene_orf_clean, orf_mature_vs_thin, by = "locus_tag")
#Pull significant genes
sig_genes_mature_thin <- orf_mature_vs_thin %>%
filter(padj < 0.05 & abs(log2FoldChange) > 1) %>%
pull(ORF)
#Separate up and down regulated genes
up_genes_mature_thin <- orf_mature_vs_thin %>%
filter(significant == "Up") %>%
pull(ORF)
down_genes_mature_thin <- orf_mature_vs_thin %>%
filter(significant == "Down") %>%
pull(ORF)
#Define new gene universe
gene_universe_mature_thin <- unique(orf_mature_vs_thin$ORF)
#GO enrichment
ego_mature_vs_thin <- enrichGO(
gene = sig_genes_mature_thin,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_mature_thin,
ont = "BP"
)
#Upregulated Biology
ego_up3 <- enrichGO(
gene = up_genes_mature_thin,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_mature_thin,
ont = "BP"
)
#Downregulated Biology
ego_down3 <- enrichGO(
gene = down_genes_mature_thin,
OrgDb = org.Sc.sgd.db,
keyType = "ORF",
universe = gene_universe_mature_thin,
ont = "BP"
)
#KEGG Enrichment
kk_mature_vs_thin <- enrichKEGG(
gene = sig_genes_mature_thin,
organism = "sce",
universe = gene_universe_mature_thin
)
#Plot
dotplot(ego_mature_vs_thin, showCategory = 10) +
ggtitle("GO-BP Early vs Mature Enrichment")
dotplot(ego_up3, showCategory = 10) +
ggtitle("GO-BP Early vs Mature Up-Regulated Gene Enrichment")
dotplot(ego_down3, showCategory = 10) +
ggtitle("GO-BP Early vs Mature Down-Regulated Gene Enrichment")
dotplot(kk_mature_vs_thin, showCategory = 10) +
ggtitle("KEGG Early vs Mature Pathway Enrichment")
#Early vs Thin Heatmap
mat_thin_genes <- rownames(mat_thin)
annot_thin <- as.data.frame(mat_thin) %>%
mutate(locus_tag = mat_thin_genes) %>%
left_join(gene_orf_clean, by = "locus_tag")
annot_thin$GENENAME <- coalesce(annot_thin$GENENAME,
annot_thin$locus_tag)
rownames(annot_thin) <- make.unique(
ifelse(annot_thin$GENENAME == annot_thin$locus_tag,
annot_thin$locus_tag,  # no gene name → show only locus
paste(annot_thin$locus_tag,
annot_thin$GENENAME,
sep=":"))
)
#Keep only expression values
annot_thin <- dplyr::select(annot_thin,-c(locus_tag, GENENAME, protein_id, ORF, SGD))
annot_mat_thin <- as.matrix(annot_thin)
#Sample annotation
rownames(sampleTable) <- sampleTable$Run
annotation_df <- sampleTable[, "stage", drop = FALSE]
colnames(annotation_df) <- "Biofilm Stage"
#Heatmap
pheatmap(annot_mat_thin,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Early vs Thin Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
#Early vs Mature Heatmap
mat_mature_genes <- rownames(mat_mature)
annot_mature <- as.data.frame(mat_mature) %>%
mutate(locus_tag = mat_mature_genes) %>%
left_join(gene_orf_clean, by = "locus_tag")
annot_mature$GENENAME <- coalesce(annot_mature$GENENAME,
annot_mature$locus_tag)
rownames(annot_mature) <- make.unique(
ifelse(annot_mature$GENENAME == annot_mature$locus_tag,
annot_mature$locus_tag,  # no gene name → show only locus
paste(annot_mature$locus_tag,
annot_mature$GENENAME,
sep=":"))
)
#Keep only expression values
annot_mature <- dplyr::select(annot_mature,-c(locus_tag, GENENAME, protein_id, ORF, SGD))
annot_mat_mature <- as.matrix(annot_mature)
#Heatmap
pheatmap(annot_mat_mature,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Early vs Mature Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
#Mature vs Thin Heatmap
mat_mature_thin_genes <- rownames(mat_mature_thin)
#Extract normalized matrix
mat_mature_thin <- assay(vsd)[mature_thin_gene_names, ]
#Remove NA genes
res_mature_thin_clean <- na.omit(res_mature_vs_thinLFC)
#Top 20 most significant genes
top_mature_thin_genes <- head(order(res_mature_thin_clean$padj), 20)
mature_thin_gene_names <- rownames(res_mature_thin_clean)[top_mature_thin_genes]
#Variance stabilizing transform
vsd <- vst(dds)
#Extract normalized matrix
mat_mature_thin <- assay(vsd)[mature_thin_gene_names, ]
#Sample annotation
rownames(sampleTable) <- sampleTable$Run
annotation_df <- sampleTable[, "stage", drop = FALSE]
colnames(annotation_df) <- "Biofilm Stage"
#Heatmap
pheatmap(mat_mature_thin,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
show_rownames = TRUE,
show_colnames = FALSE)
#Early vs Thin Heatmap
mat_thin_genes <- rownames(mat_thin)
annot_thin <- as.data.frame(mat_thin) %>%
mutate(locus_tag = mat_thin_genes) %>%
left_join(gene_orf_clean, by = "locus_tag")
annot_thin$GENENAME <- coalesce(annot_thin$GENENAME,
annot_thin$locus_tag)
rownames(annot_thin) <- make.unique(
ifelse(annot_thin$GENENAME == annot_thin$locus_tag,
annot_thin$locus_tag,  # no gene name → show only locus
paste(annot_thin$locus_tag,
annot_thin$GENENAME,
sep=":"))
)
#Keep only expression values
annot_thin <- dplyr::select(annot_thin,-c(locus_tag, GENENAME, protein_id, ORF, SGD))
annot_mat_thin <- as.matrix(annot_thin)
#Sample annotation
rownames(sampleTable) <- sampleTable$Run
annotation_df <- sampleTable[, "stage", drop = FALSE]
colnames(annotation_df) <- "Biofilm Stage"
#Heatmap
pheatmap(annot_mat_thin,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Early vs Thin Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
#Early vs Mature Heatmap
mat_mature_genes <- rownames(mat_mature)
annot_mature <- as.data.frame(mat_mature) %>%
mutate(locus_tag = mat_mature_genes) %>%
left_join(gene_orf_clean, by = "locus_tag")
annot_mature$GENENAME <- coalesce(annot_mature$GENENAME,
annot_mature$locus_tag)
rownames(annot_mature) <- make.unique(
ifelse(annot_mature$GENENAME == annot_mature$locus_tag,
annot_mature$locus_tag,  # no gene name → show only locus
paste(annot_mature$locus_tag,
annot_mature$GENENAME,
sep=":"))
)
#Keep only expression values
annot_mature <- dplyr::select(annot_mature,-c(locus_tag, GENENAME, protein_id, ORF, SGD))
annot_mat_mature <- as.matrix(annot_mature)
#Heatmap
pheatmap(annot_mat_mature,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Early vs Mature Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
#Mature vs Thin Heatmap
mat_mature_thin_genes <- rownames(mat_mature_thin)
annot_mature_thin <- as.data.frame(mat_mature_thin) %>%
mutate(locus_tag = mat_mature_thin_genes) %>%
left_join(gene_orf_clean, by = "locus_tag")
annot_mature_thin$GENENAME <- coalesce(annot_mature_thin$GENENAME,
annot_mature_thin$locus_tag)
rownames(annot_mature_thin) <- make.unique(
ifelse(annot_mature_thin$GENENAME == annot_mature_thin$locus_tag,
annot_mature_thin$locus_tag,  # no gene name → show only locus
paste(annot_mature_thin$locus_tag,
annot_mature_thin$GENENAME,
sep=":"))
)
#Keep only expression values
annot_mature_thin <- dplyr::select(annot_mature_thin,-c(locus_tag, GENENAME, protein_id, ORF, SGD))
annot_mat_mature_thin <- as.matrix(annot_mature_thin)
#Heatmap
pheatmap(annot_mat_mature_thin,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Mature vs Thin Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
dotplot(go_compare, showCategory = 10) +
ggtitle("GO-BP Enrichment by Cluster")
dotplot(kegg_compare, showCategory = 10) +
ggtitle("KEGG Pathway Enrichment by Cluster")
clusters <- degPatterns(cluster_rlog,
metadata = sampleTable,
time = "stage")
ggplot(pca_data, aes(PC1, PC2, color = stage)) +
geom_point(size = 4) +
xlab(paste0("PC1: ", percentVar[1], "% variance")) +
ylab(paste0("PC2: ", percentVar[2], "% variance")) +
coord_fixed() +
theme_minimal()
ggplot(res_thin_vs_early_df, aes(x = log2FoldChange, y = -log10(padj), color = significant)) + #make plot
geom_point() +
scale_color_manual(values = c("Down" = "blue", "Not Sig" = "gray", "Up" = "red")) +
labs(x = "Log2 Fold Change", y = "-Log10 p-value",
title = "Volcano Plot: Thin vs Early") +
theme(legend.position = "right")
scale_color_manual(values = c("Down" = "blue", "Not Sig" = "gray", "Up" = "red")) +
labs(x = "Log2 Fold Change", y = "-Log10 p-value",
title = "Volcano Plot: Mature vs Early") +
theme(legend.position = "right")
ggplot(res_mature_vs_early_df, aes(x = log2FoldChange, y = -log10(padj), color = significant)) + #make plot
geom_point() +
scale_color_manual(values = c("Down" = "blue", "Not Sig" = "gray", "Up" = "red")) +
labs(x = "Log2 Fold Change", y = "-Log10 p-value",
title = "Volcano Plot: Mature vs Early") +
theme(legend.position = "right")
ggplot(res_mature_vs_thin_df, aes(x = log2FoldChange, y = -log10(padj), color = significant)) + #make plot
geom_point() +
scale_color_manual(values = c("Down" = "blue", "Not Sig" = "gray", "Up" = "red")) +
labs(x = "Log2 Fold Change", y = "-Log10 p-value",
title = "Volcano Plot: Mature vs Thin") +
theme(legend.position = "right")
dotplot(ego_thin_vs_early, showCategory = 10) +
ggtitle("GO-BP Early vs Thin Enrichment")
dotplot(ego_up, showCategory = 10) +
ggtitle("GO-BP Early vs Thin Up-Regulated Gene Enrichment")
dotplot(ego_down, showCategory = 10) +
ggtitle("GO-BP Early vs Thin Down-Regulated Gene Enrichment")
dotplot(kk_thin_vs_early, showCategory = 10) +
ggtitle("KEGG Early vs Thin Pathway Enrichment")
dotplot(ego_thin_vs_early, showCategory = 10) +
ggtitle("GO-BP Thin vs Early Enrichment")
dotplot(ego_up, showCategory = 10) +
ggtitle("GO-BP Thin vs Early Up-Regulated Gene Enrichment")
dotplot(ego_down, showCategory = 10) +
ggtitle("GO-BP Thin vs Early Down-Regulated Gene Enrichment")
dotplot(kk_thin_vs_early, showCategory = 10) +
ggtitle("KEGG Thin vs Early Pathway Enrichment")
dotplot(ego_mature_vs_early, showCategory = 10) +
ggtitle("GO-BP Mature vs Early Enrichment")
dotplot(ego_up2, showCategory = 10) +
ggtitle("GO-BP Mature vs Early Up-Regulated Gene Enrichment")
dotplot(ego_down2, showCategory = 10) +
ggtitle("GO-BP Mature vs Early Down-Regulated Gene Enrichment")
dotplot(kk_mature_vs_early, showCategory = 10) +
ggtitle("KEGG Mature vs Early Pathway Enrichment")
dotplot(ego_mature_vs_thin, showCategory = 10) +
ggtitle("GO-BP Mature vs Thin Enrichment")
dotplot(ego_up3, showCategory = 10) +
ggtitle("GO-BP Mature vs Thin Up-Regulated Gene Enrichment")
dotplot(ego_down3, showCategory = 10) +
ggtitle("GO-BP Mature vs Thin Down-Regulated Gene Enrichment")
dotplot(kk_mature_vs_thin, showCategory = 10) +
ggtitle("KEGG Mature vs Thin Pathway Enrichment")
#Heatmap
pheatmap(annot_mat_thin,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Early vs Thin Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
pheatmap(annot_mat_thin,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Thin vs Early Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
pheatmap(annot_mat_mature,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Mature vs Early Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
pheatmap(annot_mat_mature_thin,
scale = "row",
cluster_rows = TRUE,
cluster_cols = TRUE,
annotation_col = annotation_df,
main = "Differential Gene Expression: Mature vs Thin Biofilm",
show_rownames = TRUE,
show_colnames = FALSE)
